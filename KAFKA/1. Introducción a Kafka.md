[[KAFKA]]

# INTRODUCCIÓN A KAFKA (CONCEPTOS BÁSICOS)

## TOPICO (TOPIC)
- Es una categoría de mensajes
- Un Canal de Eventos
- No es una cola tradicional
- Los mensajes no se borran ni por política ni al consumir
- Se borran por política de retención
- Muchos consumidores poder leer el mismo tópico
- 
---
## PARTICION (PARTITION)
Cada tópico se divide en particiones
Que da una partición:
- Orden garantizado dentro de la partición
- Paralelismo (Una partición = Consumidor Activo)
Ejemplo:
```sh
Topic: pagos-tarjeta
Partitions: 6
```
Máximo 6 consumers procesando en paralelo en un mismo grupo

Si en todo se usa una key (ej: idCuenta)
- Todos los mensajes de esa cuenta
	- Ven la misma partición
	- Se procesan en orden

---

## POSICIÓN (OFFSET)
Es el número de mensaje dentro de una partición
- Kafka no sabe si lo procesaste bien
- Tu le dices cuando debe de avanzar
```sh
Partition : 2
Offset: 120 -> Mensaje Acual
Offset: 121 -> Mensaje Siguiente
```
**Si fallas antes de confirmar:**
 - Kafka lo vuelve a mandar
 **Esto no es un bug, es diseño**

---
## Trabajo en Equipo (Consumer Group)
- Es un conjunto de consumidores
- Se reparten las particiones
**Regla de Oro:** Una partición -> Un solo Consumer dentro del Grupo

### Escenarios Clave
- Mismo group.id -> Trabajo Distribuido
- Distinto group.id -> Cada uno lee todo
Ejemplo:
```sh
group: pagos-processor
	- consumer A -> partition 0,1
	- consumer B -> partition 2,3
```

---

## **Analogía en Kafka**

**Topic** -> Peridico Completo
**Partition** -> Secciones del periódico
**Offset** -> Página de la sección
**Consumer Group **-> Equipo de Lectores que se reparten las secciones  para leer sin repetir trabajo

El group  Id debe asignarse de manera manual desde el consumidor, puede ser Java, Python o puesto externamente, Kafka solo orquesta y arma los grupos con mismo ``group.id``